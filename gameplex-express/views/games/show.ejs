<%- include('../partials/header') %>

<h1 class="fontTitle"><%= game.name %></h1>
<img src="<%= game.poster %>" alt="<%= game.name %>" class="profileImg">
<h5>Type: <%= game.type %></h5>

<% if (game.sessionIds.length){ %>
    <% game.sessionIds.forEach(session => { %>
        <div>
            <h6>Location: <%= session.location %></h6>
            <h6>Date: <%= session.date %></h6>
            <h6>Players: <%= session.playersIds.length %>/<%= session.max %></h6>
            <span>
                <% session.playersIds.forEach(player => { %>
                    <label><%= player.name %></label>
                <% }); %>
            </span>
            <h6><%= session.playersIds.length %>/<%= session.max %></h6>
        </div>
        <%if (user){ 
            if (session.playersIds.length > 0){
        if (user.googleId === session.playersIds[0].googleId) {%>
        <form action="/sessions/<%= session._id %>?_method=DELETE&id=<%= game._id %>" method="post">
            <input type="submit" value="Remove Session">
        </form>
        <% } }%>
        <% if (!session.playersIds.some(obj => obj.googleId === user.googleId) && session.playersIds.length < session.max) { %>
            <form action="/sessions/<%= session._id %>/join?_method=PUT&id=<%= game._id %>" method="post">
            <input type="submit" value="Join Session">
        </form>
        <%} %>
        <% if (session.playersIds.some(obj => obj.googleId === user.googleId)) { %>
            <form action="/sessions/<%= session._id %>/leave?_method=PUT&id=<%= game._id %>" method="post">
            <input type="submit" value="Leave Session">
        </form>
        <%} %>
        <% if (session.playersIds.some(obj => obj.googleId === user.googleId)) { 
            session.comments.forEach((comment,i) => { %>
                <label><%= comment.name %></label>
                <p><%= comment.content %></p>
                <% if ( user.name === comment.name) { %>
                    <form action="/sessions/<%= session._id %>/comments?_method=DELETE&id=<%= game._id %>&index=<%= i %>" method="post">
                <input type="submit" value="Delete Comment">
            </form>
            <%} })%>
            <form action="/sessions/<%= session._id %>/comments?_method=PUT&id=<%= game._id %>" method="post">
                <input type="text" placeholder="Comment" name="content">
                <input type="submit" value="comment">
            </form>
        <% } %>
<%}})} %>



<% if(user){ %>
<form action="/games/<%= game._id %>/sessions" method="post">
    <input type="text" placeholder="Location" name="location">
    <input type="date" placeholder="Date" name="date">
    <input type="number" placeholder="Max Players" name="max">
    <input type="submit" value="Create Session">
</form>
<% } %>
<%- include('../partials/footer') %>

